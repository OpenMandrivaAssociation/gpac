--- gpac-0.5.0-svn5277/modules/ffmpeg_in/ffmpeg_demux.c.orig	2014-06-15 17:14:53.000000000 +0100
+++ gpac-0.5.0-svn5277/modules/ffmpeg_in/ffmpeg_demux.c	2014-11-04 22:38:28.752242000 +0000
@@ -314,7 +314,11 @@
 	}
 
 exit:
+#ifndef FF_API_CLOSE_INPUT_FILE
 	if (ctx) av_close_input_file(ctx);
+#else
+	if (ctx) avformat_close_input(&ctx);
+#endif
 	return ret;
 }
 
@@ -685,7 +689,11 @@
 
 		ffd->seekable = (av_seek_frame(ffd->ctx, -1, 0, AVSEEK_FLAG_BACKWARD)<0) ? 0 : 1;
 		if (!ffd->seekable) {
+#ifndef FF_API_CLOSE_INPUT_FILE
 			av_close_input_file(ffd->ctx);
+#else
+			avformat_close_input(&ffd->ctx);
+#endif
 			ffd->ctx = NULL;
 			open_file(&ffd->ctx, szName, av_in);
 			av_find_stream_info(ffd->ctx);
@@ -700,7 +708,11 @@
 
 err_exit:
 	GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAINER, ("[FFMPEG] Error opening file %s: %s\n", url, gf_error_to_string(e)));
+#ifndef FF_API_CLOSE_INPUT_FILE
 	if (ffd->ctx) av_close_input_file(ffd->ctx);
+#else
+	if (ffd->ctx) avformat_close_input(&ffd->ctx);
+#endif
 	ffd->ctx = NULL;
 	gf_term_on_connect(serv, NULL, e);
 	return GF_OK;
@@ -754,7 +766,12 @@
 
 	ffd->is_running = 0;
 
+#ifndef FF_API_CLOSE_INPUT_FILE
 	if (ffd->ctx) av_close_input_file(ffd->ctx);
+#else
+	if (ffd->ctx) avformat_close_input(&ffd->ctx);
+#endif
+
 	ffd->ctx = NULL;
 	ffd->audio_ch = ffd->video_ch = NULL;
 	ffd->audio_run = ffd->video_run = 0;
